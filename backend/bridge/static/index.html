<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>IdeasGlass</title>
    <link rel="manifest" href="/static/manifest.webmanifest" />
    <link rel="stylesheet" href="/static/styles.css" />
    <link rel="icon" type="image/png" href="/static/icons/icon-192.png" />
    <meta name="theme-color" content="#0c1220" />
  </head>
  <body class="header-fixed">
    <header>
      <div>
        <h1>IdeasGlass</h1>
        <p class="subtitle" data-i18n="header.subtitle">Catch ideas as they happen</p>
      </div>
      <div class="header-actions">
        <span id="batteryStatus" class="battery-pill" title="Battery">üîã --%</span>
        <select id="langSelect" class="lang-select" aria-label="Language">
          <option value="en">English</option>
          <option value="zh-Hant">ÁπÅÈ´î‰∏≠Êñá</option>
          <option value="zh-Hans">ÁÆÄ‰Ωì‰∏≠Êñá</option>
          <option value="ja">Êó•Êú¨Ë™û</option>
        </select>
      </div>
    </header>

    <div id="liveView" class="view">
    <div id="liveMainView">
    <section class="recorder-section">
      <div class="recorder-core">
        <div class="main-controls">
          <div class="controls-left">
            <div class="timer" id="timer">LIVE</div>
            <div class="live-dot" aria-hidden="true"></div>
          </div>
          <div id="vadStatus" class="vad-status silence">üîá SILENCE</div>
        </div>
        <div class="waveform" id="waveform">
          <div id="waveformBars" class="waveform-bars"></div>
        </div>
      </div>
      <div class="status-with-toggle">
        <div id="audioStatus" class="status" aria-live="polite">Listening for audio chunks‚Ä¶</div>
      </div>
      <div class="transcript-panel" id="transcriptPanel">
        <div class="transcript-placeholder">Waiting for transcript‚Ä¶</div>
      </div>
    </section>

    <main>
      <section id="logPanel">
        <h2 data-i18n="live.incoming_photos">Incoming photos</h2>
        <ul id="messageList"></ul>
        <div id="galleryGridCompact" class="gallery-grid gallery-grid--compact"></div>
      </section>

      <section id="transcriptsPanel">
        <h2 data-i18n="live.transcripts">Transcripts</h2>
        <ul id="transcriptCompactList"></ul>
        <div class="load-more-container">
          <button id="transcriptsMoreCompactBtn" type="button" data-i18n="btn.more">More ¬ª</button>
        </div>
      </section>
    </main>
    </div>

    <!-- Live photos page (push-style, not overlay) -->
    <div id="livePhotosView" class="hidden">
      <main>
        <section>
          <div style="display:flex;align-items:center;gap:0.5rem;justify-content:space-between;">
            <button id="livePhotosBack" class="ghost-btn" type="button" data-i18n="btn.back_to_live">‚Üê Back to Live</button>
            <h2 data-i18n="live.photos">Photos</h2>
            <span></span>
          </div>
          <div id="galleryGrid" class="gallery-grid"></div>
          <div class="load-more-container">
            <button id="loadMoreBtn" type="button" hidden data-i18n="btn.show_older_photos">Show older photos</button>
          </div>
        </section>
      </main>
    </div>

    <!-- Live transcripts page (push-style) -->
    <div id="liveTranscriptsView" class="hidden">
      <main>
        <section>
          <div style="display:flex;align-items:center;gap:0.5rem;justify-content:space-between;">
            <button id="liveTranscriptsBack" class="ghost-btn" type="button" data-i18n="btn.back_to_live">‚Üê Back to Live</button>
            <h2 data-i18n="live.transcripts">Transcripts</h2>
            <span></span>
          </div>
          <ul id="transcriptList"></ul>
          <div class="load-more-container">
            <button id="transcriptMoreBtn" type="button" hidden data-i18n="btn.show_older_transcripts">Show older transcripts</button>
          </div>
        </section>
      </main>
    </div>

    <!-- Live transcript detail page (push-style) -->
    <div id="liveTranscriptDetailView" class="hidden">
      <main>
        <section>
          <div class="subpage-header">
            <button id="liveTranscriptDetailBack" class="ghost-btn" type="button" data-i18n="btn.back">‚Üê Back</button>
            <h2 data-i18n="live.transcript">Transcript</h2>
          </div>
          <audio id="transcriptDetailAudio" controls style="width:100%;margin:0.3rem 0 0.6rem;"></audio>
          <div id="transcriptDetailBody" class="segment-transcript-body">
            Loading transcript‚Ä¶
          </div>
        </section>
      </main>
    </div>

    <!-- Login overlay (shown on Live when not signed in) -->
    <div id="loginOverlay" class="login-overlay hidden">
      <div class="login-overlay-backdrop"></div>
      <div class="login-overlay-card" role="dialog" aria-label="Sign in to IdeasGlass">
        <h3>Welcome to IdeasGlass</h3>
        <p class="overlay-sub">Sign in to continue</p>
        <form id="overlayAuthForm" class="overlay-auth-form" action="javascript:void(0)">
          <input id="overlayEmail" type="email" placeholder="Email" />
          <input id="overlayPassword" type="password" placeholder="Password" />
          <div class="overlay-actions">
            <button id="overlayLoginBtn" type="button">Login</button>
            <button id="overlayRegisterBtn" type="button" class="ghost-btn">Register</button>
            <button id="overlayToSettingsBtn" type="button" class="ghost-btn">Go to Settings</button>
          </div>
          <div id="overlayAuthStatus" class="status"></div>
        </form>
      </div>
    </div>

    </div>

    <div id="ideasView" class="view hidden">
      <main>
        <section class="ideas-panel">
          <div class="ideas-header">
            <h2 data-i18n="ideas.plural">Ideas</h2>
            <div class="ideas-actions">
              <button id="seedIdeasBtn" type="button" class="ghost-btn">Generate Samples</button>
            </div>
          </div>
          <p class="ideas-sub">Ranked by importance based on occurrence √ó urgency √ó recency.</p>
          <div id="ideasGrid" class="ideas-grid"></div>
        </section>
      </main>
    </div>

    <!-- Idea detail sub-page (push-style) -->
    <div id="ideaDetailView" class="hidden">
      <main>
        <section class="ideas-panel">
          <div class="ideas-header">
            <button id="ideaDetailBack" class="ghost-btn" type="button" data-i18n="btn.back_to_ideas">‚Üê Back to Ideas</button>
            <h2 data-i18n="ideas.singular">Idea</h2>
            <div class="ideas-actions">
              <button id="ideaDeleteBtn" type="button" class="ghost-btn">Delete</button>
            </div>
          </div>
          <div class="idea-form">
            <label class="if-label">Title</label>
            <input id="ideaTitleInput" class="if-input" placeholder="Title" />
            <label class="if-label">Summary</label>
            <textarea id="ideaSummaryInput" class="if-textarea" rows="4" placeholder="Summary"></textarea>
            <div class="if-row">
              <div class="if-col">
                <label class="if-label">Language</label>
                <input id="ideaLanguageInput" class="if-input" placeholder="en / zh" />
              </div>
              <div class="if-col">
                <label class="if-label">Tags (comma separated)</label>
                <input id="ideaTagsInput" class="if-input" placeholder="writing, video" />
              </div>
            </div>
            <div class="if-meta">
              <span id="ideaStatusBadge" class="idea-lang">ACTIVE</span>
              <span id="ideaScoreBadge" class="idea-score">--%</span>
              <small id="ideaMetaText" class="muted"></small>
            </div>
            <div class="if-actions">
              <button id="ideaSaveBtn" type="button">Save</button>
              <button id="ideaArchiveBtn" type="button" class="ghost-btn">Archive</button>
            </div>
          </div>
        </section>
      </main>
    </div>

    <div id="goalView" class="view hidden">
      <main>
        <section class="goals-panel">
          <div id="prophecyPanel" class="prophecy-card">
            <div class="prophecy-left">
              <div class="prophecy-title">Prophecy Diary</div>
              <div class="prophecy-sub" id="prophecyTeaser">Define who you want to be and what you want to do ‚Äî a gentle plan for a happy life.</div>
            </div>
            <div class="prophecy-actions">
              <button id="prophecyViewBtn" type="button">View</button>
              <button id="prophecySeedBtn" type="button" class="ghost-btn">Seed Sample</button>
            </div>
          </div>
          <div class="goals-header">
            <h2 data-i18n="goal.plural">Goals</h2>
            <div class="goals-actions">
              <button id="seedGoalsBtn" type="button" class="ghost-btn">Generate Samples</button>
            </div>
          </div>
          <p class="goals-sub">Life ‚Üí Goal ‚Üí Plan ‚Üí Steps. Track progress elegantly.</p>
          <div id="goalsGrid" class="goals-grid"></div>
        </section>
      </main>
    </div>

    <!-- Goal detail sub-page (push-style) -->
    <div id="goalDetailView" class="hidden">
      <main>
        <section class="goals-panel">
          <div class="goals-header">
            <button id="goalDetailBack" class="ghost-btn" type="button">‚Üê Back to Goals</button>
            <h2>Goal</h2>
            <div class="goals-actions">
              <button id="goalDeleteBtn" type="button" class="ghost-btn">Delete</button>
            </div>
          </div>
          <div class="goal-form">
            <label class="if-label">Title</label>
            <input id="goalTitleInput" class="if-input" placeholder="Title" />
            <label class="if-label">Outcome</label>
            <textarea id="goalOutcomeInput" class="if-textarea" rows="3" placeholder="Outcome"></textarea>
            <div class="if-row">
              <div class="if-col">
                <label class="if-label">Deadline</label>
                <input id="goalDeadlineInput" class="if-input" type="datetime-local" />
              </div>
              <div class="if-col">
                <label class="if-label">Priority</label>
                <select id="goalPriorityInput" class="if-input">
                  <option value="0">P0</option>
                  <option value="1">P1</option>
                  <option value="2">P2</option>
                  <option value="3">P3</option>
                  <option value="4">P4</option>
                  <option value="5">P5</option>
                </select>
              </div>
            </div>
            <div class="if-row">
              <div class="if-col">
                <label class="if-label">Status</label>
                <select id="goalStatusInput" class="if-input">
                  <option value="0">Not started</option>
                  <option value="1">In progress</option>
                  <option value="2">Blocked</option>
                  <option value="3">Done</option>
                  <option value="4">Canceled</option>
                </select>
              </div>
              <div class="if-col">
                <label class="if-label">Progress %</label>
                <input id="goalProgressInput" class="if-input" type="number" min="0" max="100" step="1" />
              </div>
            </div>
            <div class="if-actions">
              <button id="goalSaveBtn" type="button">Save</button>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Life goal (Prophecy) detail sub-page -->
    <div id="lifeGoalDetailView" class="hidden">
      <main>
        <section class="goals-panel">
          <div class="goals-header lifegoal-header">
            <button id="lifeGoalDetailBack" class="ghost-btn" type="button">‚Üê Back to Goals</button>
            <h2>Prophecy Diary</h2>
            <span></span>
          </div>
          <div class="life-goal-detail">
            <h3 id="lgTitle" class="goal-title"></h3>
            <div class="lg-grid">
              <div class="lg-card lg-prophecy">
                <div class="lg-card-title">Prophecy</div>
                <div id="lgDiary" class="diary-text lg-card-body"></div>
              </div>

              <div class="lg-card lg-identity">
                <div class="lg-card-title">Who am I</div>
                <div id="lgIdentity" class="identity-text lg-card-body"></div>
              </div>

              <div class="lg-card lg-vision">
                <div class="lg-card-title">Vision</div>
                <div id="lgVision" class="goal-outcome lg-card-body"></div>
              </div>

              <div class="lg-row">
                <div class="lg-chip-card"><span class="chip" id="lgHorizon">LIFE</span></div>
                <div class="lg-chip-card"><span class="chip" id="lgProgress">0%</span></div>
              </div>

              <div class="lg-card lg-why">
                <div class="lg-card-title">Why</div>
                <div id="lgWhy" class="cd-section-body lg-card-body"></div>
              </div>

              <div class="lg-card lg-strategy">
                <div class="lg-card-title">Strategy</div>
                <pre id="lgStrategy" class="cd-section-body lg-card-body"></pre>
              </div>

              <div class="lg-card lg-metrics">
                <div class="lg-card-title">Metrics</div>
                <ul id="lgMetrics" class="lg-card-body lg-metrics-list"></ul>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <div id="creationView" class="view hidden">
      <main>
        <section class="creation-panel">
          <div class="creation-header">
            <h2 data-i18n="creation.plural">Creation</h2>
            <div class="creation-actions">
              <button id="seedCreationsBtn" type="button" class="ghost-btn">Generate Samples</button>
            </div>
          </div>
          <p class="creation-sub">Turn your ideas into concrete outputs ‚Äî plans, proposals, posts, videos, and more.</p>

          <div class="quick-create">
            <div class="qc-row">
              <label class="qc-label">From idea</label>
              <select id="createFromIdeaSelect"></select>
            </div>
            <div class="qc-row">
              <label class="qc-label">Type</label>
              <select id="createTypeSelect">
                <option value="business_plan">Business plan</option>
                <option value="research_proposal">Research proposal</option>
                <option value="video_project">Video project</option>
                <option value="story_post">Story / Post</option>
                <option value="novel_project">Novel project</option>
                <option value="script_project">Script project</option>
                <option value="music_track">Music track</option>
                <option value="small_file">Small file</option>
              </select>
              <button id="createFromIdeaBtn" type="button">Create</button>
            </div>
          </div>

          <div id="creationsGrid" class="creations-grid"></div>
        </section>
      </main>
    </div>

    <!-- Creation detail sub-page (push-style) -->
    <div id="creationDetailView" class="hidden">
      <main>
        <section class="creation-panel">
          <div class="creation-header">
            <button id="creationDetailBack" class="ghost-btn" type="button" data-i18n="btn.back_to_creations">‚Üê Back to Creations</button>
            <h2 data-i18n="creation.singular">Creation</h2>
            <span></span>
          </div>
          <div class="creation-detail">
            <div class="cd-header">
              <h3 id="creationTitle" class="creation-title"></h3>
              <span id="creationTypeBadge" class="creation-type"></span>
            </div>
            <p id="creationSummary" class="creation-summary"></p>
            <div class="creation-meta">
              <small id="creationMetaText" class="muted"></small>
              <a id="creationOutcomeLink" class="creation-link" target="_blank" rel="noopener" hidden>Open</a>
            </div>
            <div class="cd-sections">
              <h4>Sections</h4>
              <div id="creationSections"></div>
            </div>
            <div class="cd-assets">
              <h4>Assets</h4>
              <ul id="creationAssets"></ul>
            </div>
          </div>
        </section>
      </main>
    </div>

    <div id="settingsView" class="view hidden">
      <main>
        <div class="settings-grid">
        <section id="accountPanel" class="card">
          <h2>Account</h2>
          <div class="account-forms">
            <div id="currentAccount" class="account-info">
              <div id="accountAvatar" class="avatar hidden">U</div>
              <span id="currentEmail"></span>
              <button id="authLogoutBtn" type="button" class="ghost-btn hidden">Logout</button>
            </div>
            <form id="authForm" class="auth-form" action="javascript:void(0)">
              <input id="authEmail" type="email" placeholder="Email" required />
              <input id="authPassword" type="password" placeholder="Password" required />
              <button id="authRegisterBtn" type="button">Register</button>
              <button id="authLoginBtn" type="button">Login</button>
            </form>
            <form id="bindForm" class="bind-form" action="javascript:void(0)">
              <input id="deviceIdInput" placeholder="Device ID" />
              <button id="bindBtn" type="button">Bind device</button>
              <span id="authStatus" class="status"></span>
            </form>
            <div id="currentDevices"></div>
          </div>
        </section>
        <section id="preferencesPanel" class="card">
          <h2>Preferences</h2>
          <form id="recordLenForm" class="pref-form" action="javascript:void(0)">
            <label for="recordLenInput" class="label">Recording length</label>
            <div class="recordlen-row">
              <input id="recordLenInput" type="number" min="5" max="60" step="1" placeholder="15" />
              <span class="suffix">seconds</span>
              <button id="recordLenSaveBtn" type="button">Save</button>
            </div>
            <div id="recordLenStatus" class="status"></div>
          </form>
          <form id="langPrefForm" class="pref-form" action="javascript:void(0)">
            <label for="mainLangSelect" class="label">Main language (content)</label>
            <div class="lang-row">
              <select id="mainLangSelect" class="if-input">
                <option value="en">English</option>
                <option value="zh-Hant">ÁπÅÈ´î‰∏≠Êñá</option>
                <option value="zh-Hans">ÁÆÄ‰Ωì‰∏≠Êñá</option>
                <option value="ja">Êó•Êú¨Ë™û</option>
              </select>
            </div>
            <div class="lang-sync-row">
              <label class="switch">
                <input id="syncUiLangCheckbox" type="checkbox" />
                <span class="slider"></span>
              </label>
              <div class="lang-sync-help">
                <strong>Sync UI to main language</strong>
                <small class="muted">UI language follows your main language when enabled.</small>
              </div>
              <button id="langPrefSaveBtn" type="button">Save</button>
            </div>
            <div id="langPrefStatus" class="status"></div>
          </form>
        </section>
        <section id="statusPanel" class="card">
          <div class="status-header">
            <h2>Status</h2>
          </div>
          <div class="status-row">
            <span class="label">Backend:</span>
            <span id="backendStatus" class="status status-offline">Offline</span>
          </div>
          <div class="status-row">
            <span class="label">WebSocket:</span>
            <span id="wsStatus" class="status status-offline">Disconnected</span>
          </div>
        </section>

        <section id="bluetoothPanel" class="card">
          <h2>Bluetooth (beta)</h2>
          <p class="install-help">Discover your IdeasGlass device over Bluetooth LE.
            <small class="muted">Android Chrome/Edge only; iOS Safari/Chrome do not support Web Bluetooth.</small>
          </p>
          <div class="ble-actions">
            <button id="bleScanBtn" type="button">Scan for devices</button>
            <span id="bleStatus" class="status"></span>
          </div>
          <ul id="bleDeviceList" class="ble-list"></ul>
        </section>

        <section id="installPanel" class="card">
          <h2>Install</h2>
          <p class="install-help">Install this PWA for a native-like IdeasGlass dashboard.</p>
          <button id="installBtn" type="button" hidden>Add to Home Screen</button>
          <small class="muted">On iOS, use ‚ÄúShare‚Äù ‚Üí ‚ÄúAdd to Home Screen‚Äù.</small>
        </section>
        </div>
      </main>
    </div>

    <footer>
      <p>Install this page on Android/iOS for a native-like IdeasGlass dashboard.</p>
    </footer>

    <!-- Photo modal -->
    <div id="photoModal" class="modal hidden" role="dialog" aria-modal="true" aria-label="Photo details">
      <div class="modal-backdrop"></div>
      <div class="modal-content">
        <button id="photoModalClose" class="modal-close" aria-label="Close">√ó</button>
        <img id="modalImage" alt="Photo" />
        <div class="modal-meta">
          <div id="modalMetaPrimary"></div>
          <small id="modalMetaSecondary"></small>
        </div>
      </div>
    </div>

    <nav id="bottomNav" class="bottom-nav">
      <button class="tab-btn active" data-tab="live" aria-label="Live">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 12h3l2-4 3 8 2-6 2 2h4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <span data-i18n="nav.live">Live</span>
      </button>
      <button class="tab-btn" data-tab="ideas" aria-label="Ideas">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M9 18h6M10 15h4M8 10a6 6 0 1 1 8 0c-1.2 1.1-2 2.2-2 3.5V15H10v-1.5c0-1.3-.8-2.4-2-3.5z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <span data-i18n="nav.ideas">Ideas</span>
      </button>
      <button class="tab-btn" data-tab="goal" aria-label="Goal">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2"/>
          <circle cx="12" cy="12" r="5" fill="none" stroke="currentColor" stroke-width="2"/>
          <circle cx="12" cy="12" r="2" fill="currentColor"/>
        </svg>
        <span data-i18n="nav.goal">Goal</span>
      </button>
      <button class="tab-btn" data-tab="creation" aria-label="Creation">
        <svg viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="8" fill="none" stroke="currentColor" stroke-width="2"/><path d="M12 8v8M8 12h8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        <span data-i18n="nav.creation">Creation</span>
      </button>
      <button class="tab-btn" data-tab="settings" aria-label="Settings">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 8h10M4 16h16M10 6v4M16 14v4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        <span data-i18n="nav.settings">Settings</span>
      </button>
    </nav>

    <script src="/static/app.js" type="module"></script>
  </body>
</html>
